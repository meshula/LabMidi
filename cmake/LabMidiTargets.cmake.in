if(NOT TARGET liblabmidi)
    include("${CMAKE_CURRENT_LIST_DIR}/LabMidiTargets.cmake")
endif()

# Ensure dependencies are available
if(NOT TARGET liblabmidi)
    message(FATAL_ERROR "LabMidi targets not found. This is likely a bug.")
endif()

# Platform-specific target properties
if(WIN32)
    set_property(TARGET liblabmidi APPEND PROPERTY 
        INTERFACE_COMPILE_DEFINITIONS "__WINDOWS_MM__" "_CRT_SECURE_NO_WARNINGS")
elseif(APPLE)
    set_property(TARGET liblabmidi APPEND PROPERTY 
        INTERFACE_COMPILE_DEFINITIONS "__MACOSX_CORE__")
elseif(UNIX)
    if(@HAVE_JACK@)
        set_property(TARGET liblabmidi APPEND PROPERTY 
            INTERFACE_COMPILE_DEFINITIONS "__LINUX_JACK__")
    else()
        set_property(TARGET liblabmidi APPEND PROPERTY 
            INTERFACE_COMPILE_DEFINITIONS "__LINUX_ALSASEQ__")
    endif()
endif()

# Create alias target if it doesn't exist
if(NOT TARGET Lab::Midi)
    add_library(Lab::Midi ALIAS liblabmidi)
endif()
